<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fitswrite</title>
  <meta name="keywords" content="fitswrite">
  <meta name="description" content="Author: R. G. Abraham, Institute of Astronomy, Cambridge University">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">main</a> &gt; <a href="index.html">matlab</a> &gt; fitswrite.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/main/matlab&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>fitswrite
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Author: R. G. Abraham, Institute of Astronomy, Cambridge University</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function fitswrite(data, filename, parname, parval) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">Author: R. G. Abraham, Institute of Astronomy, Cambridge University
        abraham@ast.cam.ac.uk
Improved by Boris Leistedt bo be compatible with MW and HEALPIX maps</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="s2let_write_hpx_real_map.html" class="code" title="function s2let_write_hpx_real_map(f, file)">s2let_write_hpx_real_map</a>	s2let_write_hpx_real_map</li><li><a href="s2let_write_mw_real_map.html" class="code" title="function s2let_write_mw_real_map(f, file)">s2let_write_mw_real_map</a>	s2let_write_mw_real_map</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function card=make_card(keyword,value)</a></li><li><a href="#_sub2" class="code">function hrec=make_header_record(card_matrix)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function fitswrite(data, filename, parname, parval)</a>
0002 <span class="comment">%Author: R. G. Abraham, Institute of Astronomy, Cambridge University</span>
0003 <span class="comment">%        abraham@ast.cam.ac.uk</span>
0004 <span class="comment">%Improved by Boris Leistedt bo be compatible with MW and HEALPIX maps</span>
0005 
0006 [nrow,ncol]=size(data);
0007 header_cards = [<a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'SIMPLE'</span>,<span class="string">'T'</span>);       <span class="keyword">...</span>
0008       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'BITPIX'</span>,16);       <span class="keyword">...</span>
0009       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'NAXIS'</span>,0);          <span class="keyword">...</span>
0010       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'EXTEND'</span>,<span class="string">'T'</span>);        <span class="keyword">...</span>
0011       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'END'</span>);];
0012   
0013 [nrowbis,ncolbis] = size(header_cards);
0014 n_blanks = 36 - rem(nrowbis,36);
0015 blank_line = setstr(ones(1,80)*32);
0016 header_cards2 = [header_cards; repmat(blank_line,n_blanks,1)];
0017 
0018 header_cards2 = [header_cards2;       <span class="keyword">...</span>
0019       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'XTENSION'</span>,<span class="string">'BINTABLE'</span>);        <span class="keyword">...</span>
0020       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'BITPIX'</span>,8);        <span class="keyword">...</span>
0021       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'NAXIS'</span>,2);          <span class="keyword">...</span>
0022       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'NAXIS1'</span>,4);      <span class="keyword">...</span>
0023       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'NAXIS2'</span>,ncol);      <span class="keyword">...</span>
0024       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'PCOUNT'</span>,0);        <span class="keyword">...</span>
0025       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'GCOUNT'</span>,1);        <span class="keyword">...</span>
0026       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'TFIELDS'</span>,1);        <span class="keyword">...</span>
0027       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'TFIELDS'</span>,1);        <span class="keyword">...</span>
0028       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'TTYPE1'</span>,<span class="string">'SIGNAL'</span>);        <span class="keyword">...</span>
0029       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'TFORM1'</span>,<span class="string">'1E'</span>);        <span class="keyword">...</span>
0030       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'TUNIT1'</span>,<span class="string">' '</span>);        <span class="keyword">...</span>
0031       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'EXTNAME'</span>,<span class="string">'BINTABLE'</span>);        <span class="keyword">...</span>
0032       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(parname, parval);        <span class="keyword">...</span>
0033       <a href="#_sub1" class="code" title="subfunction card=make_card(keyword,value)">make_card</a>(<span class="string">'END'</span>)];
0034 
0035 header_record = <a href="#_sub2" class="code" title="subfunction hrec=make_header_record(card_matrix)">make_header_record</a>(header_cards2);
0036 <span class="comment">%[ncards,dummy]=size(header_cards);</span>
0037 <span class="comment">%fprintf(header_record(1,:));</span>
0038 
0039 fid=fopen(filename,<span class="string">'w'</span>);
0040 fwrite(fid,header_record',<span class="string">'char'</span>);
0041 
0042 <span class="comment">% try to figure out if we need to swap bytes. This is</span>
0043 <span class="comment">% imperfect as I don't know the endian-ness of each</span>
0044 <span class="comment">% architecture, so I'm only looking for ones I know for</span>
0045 <span class="comment">% sure are big-endian.</span>
0046 friend = computer;
0047 <span class="keyword">if</span> strmatch(friend,<span class="string">'PCWIN'</span>)
0048    bswap = <span class="string">'b'</span>;
0049 <span class="keyword">elseif</span> strmatch(friend,<span class="string">'LNX86'</span>)
0050    bswap = <span class="string">'b'</span>;   
0051 <span class="keyword">elseif</span> strmatch(friend,<span class="string">'ALPHA'</span>)
0052    bswap = <span class="string">'b'</span>;
0053 <span class="keyword">else</span>
0054    bswap = <span class="string">'l'</span>;
0055 <span class="keyword">end</span>
0056 
0057 fwrite(fid, data, <span class="string">'single'</span>, 0, <span class="string">'B'</span>);
0058 <span class="comment">%fwrite(fid,data,'single',bswap);</span>
0059 fclose(fid);
0060 
0061 
0062 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0063 
0064 
0065 <a name="_sub1" href="#_subfunctions" class="code">function card=make_card(keyword,value)</a>
0066 <span class="comment">%MAKE_CARD turns a set of strings into a valid FITS card</span>
0067 <span class="comment">%Make keyword field 8 bytes long</span>
0068 lk=length(keyword);
0069 <span class="keyword">if</span> (lk &gt; 8) &amp; (nargin&gt;1)
0070     error(<span class="string">'Keyword must be less than or equal to 8 characters!'</span>)
0071 <span class="keyword">elseif</span> (lk &lt; 8 )
0072     keyword=[keyword,setstr(ones(1,8-lk)*32)];
0073 <span class="keyword">end</span>;
0074 
0075 <span class="comment">%Deal with both straight keyword and keyword/value pair</span>
0076 <span class="keyword">if</span> (nargin==1)
0077     <span class="comment">%Keyword without a value</span>
0078     card=keyword;    
0079 <span class="keyword">else</span>
0080     <span class="comment">%Key/value pair has an equal sign and space at bytes 9 and 10</span>
0081     card=[keyword,<span class="string">'= '</span>];
0082 
0083     <span class="comment">%Now output the value. The FITS standard wants things to start</span>
0084     <span class="comment">%in different columns depending on what type of data the</span>
0085     <span class="comment">%value holds, according to the following rules:</span>
0086     <span class="comment">%</span>
0087     <span class="comment">%  Logical: T or F in column 30</span>
0088     <span class="comment">%</span>
0089     <span class="comment">%  Character string: A beginning quote in column 11 and an</span>
0090     <span class="comment">%  ending quote between columns 20 and 80.</span>
0091     <span class="comment">%</span>
0092     <span class="comment">%  Real part of an integer or floating point number: right</span>
0093     <span class="comment">%  justified, ending in column 30.</span>
0094     <span class="comment">%</span>
0095     <span class="comment">%  Imaginary part: right justified, ending in</span>
0096     <span class="comment">%  column 50, starting after column 30 (NB. I won't bother</span>
0097     <span class="comment">%  to support an imaginary part in this M-file, and will</span>
0098     <span class="comment">%  let some radio astronomer who needs it add it if they want).</span>
0099 
0100     <span class="keyword">if</span> isstr(value)
0101           <span class="comment">%Test for logical. If logical it goes in column 30</span>
0102         <span class="keyword">if</span> (length(value)==1) &amp; (strmatch(upper(value),<span class="string">'T'</span>) | strmatch(upper(value),<span class="string">'F'</span>))
0103              card=[card,setstr(ones(1,19)*32),value];    
0104         <span class="keyword">else</span>    
0105             <span class="comment">%Value must be a character string. Pad if less than 8</span>
0106             <span class="comment">%characters long.</span>
0107             lv=length(value);
0108             <span class="keyword">if</span> (lv &gt; 70)
0109            error(<span class="string">'Value must be less than 70 characters long!'</span>)
0110             <span class="keyword">elseif</span> (lv &lt; 10 )
0111              value=[value,setstr(ones(1,8-lv)*32)];
0112             <span class="keyword">end</span>;
0113             card=[card,<span class="string">''''</span>,value,<span class="string">''''</span>];
0114         <span class="keyword">end</span>;    
0115     <span class="keyword">else</span>
0116         <span class="comment">%Value must be a number. Convert to a string. Maximum</span>
0117         <span class="comment">%precision is set to 10 digits</span>
0118         value=num2str(value,10);
0119         lv=length(value);
0120     
0121         <span class="comment">%Write this out so it will end on column 30</span>
0122         card=[card,setstr(ones(1,20-lv)*32),value];    
0123     <span class="keyword">end</span>;
0124 <span class="keyword">end</span>;
0125 
0126 <span class="comment">%Now pad the output to make it exactly 80 bytes long</span>
0127 card=[card,setstr(ones(1,80-length(card))*32)];
0128 
0129 
0130 
0131 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0132 
0133 <a name="_sub2" href="#_subfunctions" class="code">function hrec=make_header_record(card_matrix)</a>
0134 
0135 [nrow,ncol] = size(card_matrix);
0136 n_blanks = 36 - rem(nrow,36);
0137 blank_line = setstr(ones(1,80)*32);
0138 hrec = [card_matrix; repmat(blank_line,n_blanks,1)];</pre></div>
<hr><address>Generated on Mon 24-Sep-2012 11:30:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>